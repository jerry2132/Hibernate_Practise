package com.hibernate.OneToMany3pm.dao;

import java.util.Set;

import javax.persistence.EntityManager;
import javax.persistence.EntityTransaction;
import javax.persistence.Persistence;

import com.hibernate.OneToMany3pm.dto.District;
import com.hibernate.OneToMany3pm.dto.State;

public class StateDistrictDao {

	
	EntityManager em = Persistence.createEntityManagerFactory("sumit").createEntityManager();
	EntityTransaction et = em.getTransaction();
	
	
	public State insertStateAndDistrict(State state) {
		
		et.begin();
		em.persist(state);
		et.commit();
		
		return state;
		
	}
	
	
	public boolean deleteDistrictByStateId(int id) {
		
		State state = em.find(State.class, id);
		
		
		Set<District> dist = state.getDistrict();
		
		District districtToRemove = null;
		
		for(District district : dist) {
			
			if(district.getId() == 1) {
				districtToRemove = district;
				break;
			}
		}
		
		if(districtToRemove != null) {
			
			et.begin();
			dist.remove(districtToRemove);
			em.remove(districtToRemove);
			et.commit();
		}
		
		return false;
		
	}
	
	public boolean deleteDistrictById(int id) {
		
		String query = "select s from State s where s.district_id=?1";
		
		
		State state =  (State) em.createQuery(query).setParameter(1, id).getSingleResult();
		
		Set<District> dist =	state.getDistrict();
		
		District districtToRemove = null;
		
		for(District district : dist) {
			
			if(district.getId() == id) {
				
				districtToRemove = district;
				break;
			}
			
		}
		
		
		if(districtToRemove != null) {
			
			et.begin();
			
			dist.remove(districtToRemove);
			em.remove(districtToRemove);
			et.commit();
			
			return true;
		}
		
//		District district = em.find(District.class, id);
		
//		System.out.println(district);
		
		
		return false;
	}
	
	public State getAll(int id) {
		
		return em.find(State.class, id);
	}
}
